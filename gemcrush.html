<html>
  <head>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
    candyCrushGame();
});

function candyCrushGame() {
   
    const ccGrid = document.querySelector(".ccGrid");
    const ccScoreDisplay = document.getElementById("ccScore");
    const ccTimerDisplay = document.getElementById("ccTimer");
    const modeSelection = document.getElementById("modeSelection");
    const endlessButton = document.getElementById("endlessMode");
    const timedButton = document.getElementById("timedMode");
    const ccChangeModeButton = document.getElementById("ccChangeMode");

    
    const width = 8;
    const squares = [];
    let ccScore = 0;
    let currentMode = null;
    let timeLeft = 0;
    let gameInterval = null;
    let ccTimerInterval = null;

    const candyColors = [
        "url(https://raw.githubusercontent.com/MorrowShore/GemCrush/main/gems/red.png)",
        "url(https://raw.githubusercontent.com/MorrowShore/GemCrush/main/gems/purple.png)",
        "url(https://raw.githubusercontent.com/MorrowShore/GemCrush/main/gems/green.png)",
        "url(https://raw.githubusercontent.com/MorrowShore/GemCrush/main/gems/yellow.png)",
        "url(https://raw.githubusercontent.com/MorrowShore/GemCrush/main/gems/white.png)",
    ];

    
    function createBoard() {
        ccGrid.innerHTML = ""; 
        squares.length = 0;  
        for (let i = 0; i < width * width; i++) {
            const square = document.createElement("div");
            square.setAttribute("draggable", true);
            square.setAttribute("id", i);
            let randomColor = Math.floor(Math.random() * candyColors.length);
            square.style.backgroundImage = candyColors[randomColor];
            ccGrid.appendChild(square);
            squares.push(square);
        }
        
        squares.forEach(square => square.addEventListener("dragstart", dragStart));
        squares.forEach(square => square.addEventListener("dragend", dragEnd));
        squares.forEach(square => square.addEventListener("dragover", dragOver));
        squares.forEach(square => square.addEventListener("dragenter", dragEnter));
        squares.forEach(square => square.addEventListener("dragleave", dragLeave));
        squares.forEach(square => square.addEventListener("drop", dragDrop));
    }

    
    let colorBeingDragged, colorBeingReplaced, squareIdBeingDragged, squareIdBeingReplaced;

    function dragStart() {
        colorBeingDragged = this.style.backgroundImage;
        squareIdBeingDragged = parseInt(this.id);
    }

    function dragOver(e) {
        e.preventDefault();
    }

    function dragEnter(e) {
        e.preventDefault();
    }

    function dragLeave() {
        
    }

    function dragDrop() {
        colorBeingReplaced = this.style.backgroundImage;
        squareIdBeingReplaced = parseInt(this.id);
        this.style.backgroundImage = colorBeingDragged;
        squares[squareIdBeingDragged].style.backgroundImage = colorBeingReplaced;
    }

    function dragEnd(e) {
    e.stopPropagation();
    
    
    if (squareIdBeingDragged === null || squareIdBeingDragged === undefined ||
        squareIdBeingReplaced === null || squareIdBeingReplaced === undefined) {
        return; 
    }
    
    
    let validMoves = [
        squareIdBeingDragged - 1,
        squareIdBeingDragged - width,
        squareIdBeingDragged + 1,
        squareIdBeingDragged + width
    ];
    
    
    if (squareIdBeingDragged % width === 0) { 
        validMoves = validMoves.filter(move => move !== squareIdBeingDragged - 1);
    }
    if (squareIdBeingDragged % width === width - 1) { 
        validMoves = validMoves.filter(move => move !== squareIdBeingDragged + 1);
    }
    
    let validMove = validMoves.includes(squareIdBeingReplaced);

    if (!validMove) {
        
        if (squares[squareIdBeingReplaced] && squares[squareIdBeingDragged]) {
            squares[squareIdBeingReplaced].style.backgroundImage = colorBeingReplaced;
            squares[squareIdBeingDragged].style.backgroundImage = colorBeingDragged;
        }
    }
    
    
    squareIdBeingDragged = null;
    squareIdBeingReplaced = null;
}

   
    function moveIntoSquareBelow() {
        
        for (let i = 0; i < width; i++) {
            if (squares[i].style.backgroundImage === "") {
                let randomColor = Math.floor(Math.random() * candyColors.length);
                squares[i].style.backgroundImage = candyColors[randomColor];
            }
        }
        
        for (let i = 0; i < width * (width - 1); i++) {
            if (squares[i + width].style.backgroundImage === "") {
                squares[i + width].style.backgroundImage = squares[i].style.backgroundImage;
                squares[i].style.backgroundImage = "";
            }
        }
    }

    
    function checkRowForFour() {
        for (let i = 0; i < 60; i++) {
            if (i % width >= width - 3) continue; 
            let rowOfFour = [i, i + 1, i + 2, i + 3];
            let decidedColor = squares[i].style.backgroundImage;
            const isBlank = squares[i].style.backgroundImage === "";
            if (rowOfFour.every(index => squares[index].style.backgroundImage === decidedColor && !isBlank)) {
                ccScore += 4;
                ccScoreDisplay.innerHTML = ccScore;
                rowOfFour.forEach(index => squares[index].style.backgroundImage = "");
            }
        }
    }

    function checkColumnForFour() {
        for (let i = 0; i < 40; i++) {
            let columnOfFour = [i, i + width, i + 2 * width, i + 3 * width];
            let decidedColor = squares[i].style.backgroundImage;
            const isBlank = squares[i].style.backgroundImage === "";
            if (columnOfFour.every(index => squares[index].style.backgroundImage === decidedColor && !isBlank)) {
                ccScore += 4;
                ccScoreDisplay.innerHTML = ccScore;
                columnOfFour.forEach(index => squares[index].style.backgroundImage = "");
            }
        }
    }

    function checkRowForThree() {
        for (let i = 0; i < 62; i++) {
            if (i % width >= width - 2) continue;
            let rowOfThree = [i, i + 1, i + 2];
            let decidedColor = squares[i].style.backgroundImage;
            const isBlank = squares[i].style.backgroundImage === "";
            if (rowOfThree.every(index => squares[index].style.backgroundImage === decidedColor && !isBlank)) {
                ccScore += 3;
                ccScoreDisplay.innerHTML = ccScore;
                rowOfThree.forEach(index => squares[index].style.backgroundImage = "");
            }
        }
    }

    function checkColumnForThree() {
        for (let i = 0; i < 48; i++) {
            let columnOfThree = [i, i + width, i + 2 * width];
            let decidedColor = squares[i].style.backgroundImage;
            const isBlank = squares[i].style.backgroundImage === "";
            if (columnOfThree.every(index => squares[index].style.backgroundImage === decidedColor && !isBlank)) {
                ccScore += 3;
                ccScoreDisplay.innerHTML = ccScore;
                columnOfThree.forEach(index => squares[index].style.backgroundImage = "");
            }
        }
    }

  
    function gameLoop() {
        checkRowForFour();
        checkColumnForFour();
        checkRowForThree();
        checkColumnForThree();
        moveIntoSquareBelow();
    }

   
    function startGame(mode) {
        currentMode = mode;
        modeSelection.style.display = "none";
        ccGrid.style.display = "flex";
        ccScoreDisplay.parentElement.style.display = "flex"; 
        createBoard();
        ccScore = 0;
        ccScoreDisplay.innerHTML = ccScore;
        gameInterval = setInterval(gameLoop, 100);

        if (mode === "timed") {
            timeLeft = 120; 
            updateccTimerDisplay();
            ccTimerInterval = setInterval(() => {
                timeLeft--;
                updateccTimerDisplay();
                if (timeLeft <= 0) {
                    clearInterval(ccTimerInterval);
                    endGame();
                }
            }, 1000);
        } else {
            ccTimerDisplay.innerHTML = ""; 
        }
    }


    function updateccTimerDisplay() {
        if (currentMode === "timed") {
            let minutes = Math.floor(timeLeft / 60);
            let seconds = timeLeft % 60;
            ccTimerDisplay.innerHTML = `Time Left: ${minutes}:${seconds.toString().padStart(2, "0")}`;
        } else {
            ccTimerDisplay.innerHTML = "";
        }
    }


    function endGame() {
        clearInterval(gameInterval);
        squares.forEach(square => square.setAttribute("draggable", false));
        alert(`Time's Up! Your score is ${ccScore}`);
    }


    function ccChangeMode() {
        clearInterval(gameInterval);
        if (currentMode === "timed") {
            clearInterval(ccTimerInterval);
        }
        ccGrid.style.display = "none";
        ccScoreDisplay.parentElement.style.display = "none";
        modeSelection.style.display = "flex"; 
    }


function dragStart(e) {
    e.stopPropagation();
    colorBeingDragged = this.style.backgroundImage;
    squareIdBeingDragged = parseInt(this.id);
}


function dragOver(e) {
    e.preventDefault();
    e.stopPropagation(); 
}

function dragEnter(e) {
    e.preventDefault();
    e.stopPropagation(); 
}

function dragLeave(e) {
    e.stopPropagation(); 
}

function dragDrop(e) {
    e.stopPropagation(); 
    colorBeingReplaced = this.style.backgroundImage;
    squareIdBeingReplaced = parseInt(this.id);
    this.style.backgroundImage = colorBeingDragged;
    squares[squareIdBeingDragged].style.backgroundImage = colorBeingReplaced;
}
    
    
    endlessButton.addEventListener("click", () => startGame("endless"));
    timedButton.addEventListener("click", () => startGame("timed"));
    ccChangeModeButton.addEventListener("click", ccChangeMode);
}
    </script>













    <style>
.ccParent {
    background-color: black;
    display: flex;
    align-items: center;
    min-height: 100vh;
    font-family: 'Montserrat', sans-serif;
    color: #ffffff;
    flex-direction: row-reverse;
    justify-content: space-evenly;
    flex-wrap: wrap;
}
  
  .ccGrid {
    box-sizing: unset;
    display: flex;
    flex-wrap: wrap;
    height: 64vh;
    width: 64vh;
    background-color: rgba(0, 0, 0, 0.5);
    padding: 5px;
    border-width: 3px;
    border-color: #B296FF;
    border-style: solid;
  }
  
  .ccGrid div {
    height: 8vh;
    width: 8vh;
    background-size: cover;
    background-position: center;
    border-radius: 5px;
    transition: transform 0.2s ease; 
  }
  
  .ccGrid div:hover {
    transform: scale(1.1); 
  }
  
 
  .ccScoreBoard {
    display: flex;
    flex-wrap: nowrap;
    flex-direction: column;
    align-content: center;
    justify-content: center;
    align-items: center;
}

  .ccGrid div:hover {
      transform: scale(1.05); 
  }
  
 
  #modeSelection {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    background-color: #000000;
    font-family: 'Montserrat', sans-serif;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 10;
    color:white;
  }
  
  #modeSelection h2 {
    margin-bottom: 20px;
    color: #ffffff;
  }
  
  #modeSelection button {
    margin: 10px;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    background-color: #B296FF;
    border-width: 3px;
    border-color: #000000;
    border-style: solid;
    color: rgb(0, 0, 0);
  }
  
  #ccTimer {
    font-size: 18px;
    margin-top: 10px;
  }
  
  #ccChangeMode {
    margin-top: 10px;
    padding: 5px 10px;
    background-color: #b296ff;
    color: #000000;
    border-width: 3px;
    border-color: #000000;
    border-style: solid;
    cursor: pointer;
}
  
  .ccGrid, .ccScoreBoard {
    display: none;
  }
    </style>


















  </head>
  <body>
    <div class="ccParent">
    <div id="modeSelection">
      <h2>Choose Game Mode</h2>
      <button id="endlessMode">Endless Mode</button>
      <button id="timedMode">Timed Mode</button>
    </div>
    <div class="ccScoreBoard">
      <h3>Score</h3>
      <h1 id="ccScore">0</h1>
      <div id="ccTimer"></div>
      <button id="ccChangeMode">Change Mode</button>
    </div>
    <div class="ccGrid"></div>
</div>
  </body>

</html>
